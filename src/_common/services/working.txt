Как работает передача новых сообщений, тем и их обновления пользователю.

1. Передача новых сообщений от уже созданных тем
Сервер отправляет клиенту сигнал, что такая-то тема имеет новое сообщение.
Клиент смотрит, сколько у него уже есть сообщений и отправляет индекс последнего сообщения, которое он сохранил.
Сервер отправляет ему массив новых сообщений.

Клиент также может запросить сообщения, если он обнаружит, что у него нет ни одного сообщения из этой темы.
Это может происходить, например, когда пользователь открывает тему впервые.

2. Обновление
Клиент сначала смотрит в сохранённую информацию о темах, компонует её и отправляет серверу.
Сервер проверяет, есть ли уже такая тема у пользователя. Если нет, то отправляет все упущенные.
Если появилась новая тема, сервер сразу же отсылает её пользователю.
Если появляется новая активность на теме, но пользователь не смотрит эту тему, то
сервер отправляет клиенту новую информацию о темах.